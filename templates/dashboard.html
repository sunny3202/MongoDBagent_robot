<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ğŸ­ AGV ìš´ì˜ ì„¼í„° ëŒ€ì‹œë³´ë“œ</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: #0f1419;
            color: #ffffff;
            min-height: 100vh;
            overflow-x: auto;
        }

        .dashboard-container {
            max-width: 1600px;
            margin: 0 auto;
            padding: 20px;
        }

        .header {
            text-align: center;
            margin-bottom: 30px;
            background: linear-gradient(135deg, #1e3a8a, #3b82f6);
            padding: 20px;
            border-radius: 15px;
            box-shadow: 0 10px 30px rgba(59, 130, 246, 0.3);
        }

        .header h1 {
            font-size: 2.5em;
            margin-bottom: 10px;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.5);
        }

        .header p {
            font-size: 1.1em;
            opacity: 0.9;
        }

        /* ì‹¤ì‹œê°„ ìš´ì˜ í˜„í™©íŒ */
        .operation-overview {
            display: grid;
            grid-template-columns: 2fr 1fr;
            gap: 20px;
            margin-bottom: 30px;
        }

        .real-time-map {
            background: linear-gradient(135deg, #1f2937, #374151);
            border-radius: 15px;
            padding: 25px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.3);
        }

        .map-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
        }

        .map-title {
            font-size: 1.4em;
            font-weight: 600;
            color: #60a5fa;
        }

        .map-status {
            display: flex;
            gap: 15px;
            font-size: 0.9em;
        }

        .status-badge {
            padding: 5px 12px;
            border-radius: 20px;
            font-weight: 500;
        }

        .status-active { background: #065f46; color: #10b981; }
        .status-warning { background: #92400e; color: #f59e0b; }
        .status-error { background: #991b1b; color: #f87171; }

        /* ê³µì¥ ë ˆì´ì•„ì›ƒ ë§µ */
        .factory-layout {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 10px;
            margin-bottom: 20px;
        }

        .zone {
            background: #374151;
            border: 2px solid #4b5563;
            border-radius: 10px;
            padding: 15px;
            min-height: 120px;
            position: relative;
            transition: all 0.3s ease;
        }

        .zone:hover {
            border-color: #60a5fa;
            transform: translateY(-2px);
        }

        .zone-header {
            font-weight: 600;
            color: #d1d5db;
            margin-bottom: 10px;
            font-size: 0.9em;
        }

        .robot-in-zone {
            display: flex;
            align-items: center;
            gap: 8px;
            background: rgba(59, 130, 246, 0.1);
            border: 1px solid #3b82f6;
            border-radius: 6px;
            padding: 6px 8px;
            margin-bottom: 5px;
            font-size: 0.8em;
        }

        .robot-status-icon {
            width: 8px;
            height: 8px;
            border-radius: 50%;
            animation: pulse 2s infinite;
        }

        .status-working { background: #10b981; }
        .status-moving { background: #3b82f6; }
        .status-idle { background: #f59e0b; }
        .status-error { background: #ef4444; }
        .status-charging { background: #8b5cf6; }

        @keyframes pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.5; }
        }

        .zone-empty {
            color: #6b7280;
            font-style: italic;
            font-size: 0.8em;
        }

        /* ìš´ì˜ í†µê³„ ì‚¬ì´ë“œë°” */
        .operation-stats {
            background: linear-gradient(135deg, #1f2937, #374151);
            border-radius: 15px;
            padding: 25px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.3);
        }

        .stats-title {
            font-size: 1.3em;
            font-weight: 600;
            color: #60a5fa;
            margin-bottom: 20px;
            text-align: center;
        }

        .stat-group {
            margin-bottom: 25px;
        }

        .stat-group h4 {
            color: #d1d5db;
            margin-bottom: 12px;
            font-size: 1em;
            border-bottom: 1px solid #4b5563;
            padding-bottom: 5px;
        }

        .stat-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 8px 0;
            border-bottom: 1px solid #374151;
        }

        .stat-item:last-child {
            border-bottom: none;
        }

        .stat-label {
            color: #9ca3af;
            font-size: 0.9em;
        }

        .stat-value {
            font-weight: 600;
            font-size: 1.1em;
        }

        .stat-value.good { color: #10b981; }
        .stat-value.warning { color: #f59e0b; }
        .stat-value.danger { color: #ef4444; }

        /* ì‹¤ì‹œê°„ ì‘ì—… í˜„í™© */
        .work-status-section {
            background: linear-gradient(135deg, #1f2937, #374151);
            border-radius: 15px;
            padding: 25px;
            margin-bottom: 30px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.3);
        }

        .work-status-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
        }

        .work-status-title {
            font-size: 1.4em;
            font-weight: 600;
            color: #60a5fa;
        }

        .work-controls {
            display: flex;
            gap: 10px;
        }

        .work-progress-list {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(350px, 1fr));
            gap: 15px;
        }

        .work-item {
            background: rgba(59, 130, 246, 0.05);
            border: 1px solid #374151;
            border-radius: 10px;
            padding: 15px;
            transition: all 0.3s ease;
        }

        .work-item:hover {
            border-color: #60a5fa;
            background: rgba(59, 130, 246, 0.1);
        }

        .work-item-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 10px;
        }

        .robot-id {
            font-weight: 600;
            color: #60a5fa;
        }

        .work-status {
            padding: 4px 10px;
            border-radius: 15px;
            font-size: 0.8em;
            font-weight: 500;
        }

        .work-status.working { background: #065f46; color: #10b981; }
        .work-status.moving { background: #1e3a8a; color: #60a5fa; }
        .work-status.waiting { background: #92400e; color: #f59e0b; }
        .work-status.error { background: #991b1b; color: #f87171; }

        .work-details {
            color: #d1d5db;
            font-size: 0.9em;
            margin-bottom: 10px;
        }

        .progress-bar {
            background: #374151;
            border-radius: 10px;
            height: 6px;
            overflow: hidden;
            margin-bottom: 8px;
        }

        .progress-fill {
            height: 100%;
            background: linear-gradient(90deg, #3b82f6, #60a5fa);
            border-radius: 10px;
            transition: width 0.5s ease;
        }

        .work-meta {
            display: flex;
            justify-content: space-between;
            gap: 15px;
            font-size: 0.8em;
            color: #9ca3af;
        }

        /* ì œì–´ íŒ¨ë„ */
        .control-panel {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
            margin-bottom: 30px;
        }

        .control-card {
            background: linear-gradient(135deg, #1f2937, #374151);
            border-radius: 15px;
            padding: 25px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.3);
        }

        .control-title {
            font-size: 1.3em;
            font-weight: 600;
            color: #60a5fa;
            margin-bottom: 20px;
        }

        .control-buttons {
            display: flex;
            gap: 15px;
            flex-wrap: wrap;
            margin-bottom: 20px;
        }

        .btn {
            padding: 12px 20px;
            border: none;
            border-radius: 8px;
            font-size: 1em;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .btn-start {
            background: linear-gradient(135deg, #059669, #10b981);
            color: white;
        }

        .btn-stop {
            background: linear-gradient(135deg, #dc2626, #ef4444);
            color: white;
        }

        .btn-emergency {
            background: linear-gradient(135deg, #991b1b, #dc2626);
            color: white;
            animation: pulse-red 2s infinite;
        }

        @keyframes pulse-red {
            0%, 100% { box-shadow: 0 0 0 0 rgba(239, 68, 68, 0.7); }
            50% { box-shadow: 0 0 0 10px rgba(239, 68, 68, 0); }
        }

        .btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 25px rgba(0,0,0,0.3);
        }

        .btn:disabled {
            opacity: 0.5;
            cursor: not-allowed;
            transform: none;
        }

        /* êµ¬ì—­ë³„ íš¨ìœ¨ì„± */
        .zone-efficiency {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
        }

        .efficiency-item {
            background: rgba(59, 130, 246, 0.05);
            border: 1px solid #374151;
            border-radius: 10px;
            padding: 15px;
            text-align: center;
        }

        .efficiency-zone {
            font-weight: 600;
            color: #60a5fa;
            margin-bottom: 8px;
        }

        .efficiency-value {
            font-size: 1.5em;
            font-weight: bold;
            margin-bottom: 5px;
        }

        .efficiency-status {
            font-size: 0.8em;
            padding: 3px 8px;
            border-radius: 10px;
        }

        .efficiency-good { color: #10b981; background: rgba(16, 185, 129, 0.1); }
        .efficiency-warning { color: #f59e0b; background: rgba(245, 158, 11, 0.1); }
        .efficiency-poor { color: #ef4444; background: rgba(239, 68, 68, 0.1); }

        /* ì•Œë¦¼ ì„¼í„° */
        .alerts-section {
            background: linear-gradient(135deg, #1f2937, #374151);
            border-radius: 15px;
            padding: 25px;
            margin-bottom: 30px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.3);
        }

        .alerts-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
        }

        .alerts-title {
            font-size: 1.4em;
            font-weight: 600;
            color: #60a5fa;
        }

        .alert-count {
            background: #dc2626;
            color: white;
            padding: 5px 10px;
            border-radius: 15px;
            font-size: 0.9em;
            font-weight: 600;
        }

        .alerts-list {
            display: flex;
            flex-direction: column;
            gap: 10px;
        }

        .alert-item {
            display: flex;
            align-items: center;
            gap: 12px;
            background: rgba(239, 68, 68, 0.05);
            border: 1px solid #dc2626;
            border-radius: 8px;
            padding: 12px;
        }

        .alert-icon {
            font-size: 1.2em;
        }

        .alert-content {
            flex: 1;
        }

        .alert-message {
            color: #f87171;
            font-weight: 500;
            margin-bottom: 3px;
        }

        .alert-time {
            color: #9ca3af;
            font-size: 0.8em;
        }

        .alert-priority {
            padding: 3px 8px;
            border-radius: 10px;
            font-size: 0.7em;
            font-weight: 600;
        }

        .priority-high { background: #991b1b; color: #fecaca; }
        .priority-medium { background: #92400e; color: #fed7aa; }
        .priority-low { background: #365314; color: #bbf7d0; }

        /* ë¡œê·¸ ì„¹ì…˜ */
        .logs-section {
            background: linear-gradient(135deg, #1f2937, #374151);
            border-radius: 15px;
            padding: 25px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.3);
        }

        .logs-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
        }

        .logs-title {
            font-size: 1.3em;
            font-weight: 600;
            color: #60a5fa;
        }

        .log-container {
            background: #111827;
            border-radius: 10px;
            padding: 15px;
            max-height: 300px;
            overflow-y: auto;
            font-family: 'Courier New', monospace;
            font-size: 0.9em;
        }

        .log-entry {
            margin-bottom: 8px;
            padding: 5px 0;
        }

        .log-info { color: #60a5fa; }
        .log-success { color: #10b981; }
        .log-warning { color: #f59e0b; }
        .log-error { color: #ef4444; }

        /* ë°˜ì‘í˜• ë””ìì¸ */
        @media (max-width: 1200px) {
            .operation-overview {
                grid-template-columns: 1fr;
            }
            
            .control-panel {
                grid-template-columns: 1fr;
            }
        }

        @media (max-width: 768px) {
            .factory-layout {
                grid-template-columns: repeat(2, 1fr);
            }
            
            .work-progress-list {
                grid-template-columns: 1fr;
            }
            
            .zone-efficiency {
                grid-template-columns: repeat(2, 1fr);
            }
        }

        /* ë¡œë”© ì• ë‹ˆë©”ì´ì…˜ */
        .loading {
            display: none;
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background: rgba(0, 0, 0, 0.8);
            padding: 30px;
            border-radius: 15px;
            text-align: center;
            z-index: 1000;
        }

        .spinner {
            border: 4px solid #374151;
            border-top: 4px solid #60a5fa;
            border-radius: 50%;
            width: 40px;
            height: 40px;
            animation: spin 1s linear infinite;
            margin: 0 auto 15px;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        /* MongoDB ì„¤ì • ìŠ¤íƒ€ì¼ */
        .mongodb-config-section {
            space-y: 20px;
        }

        .connection-status {
            display: flex;
            align-items: center;
            gap: 10px;
            padding: 15px;
            background: rgba(59, 130, 246, 0.1);
            border-radius: 10px;
            margin-bottom: 20px;
            border: 2px solid transparent;
            transition: all 0.3s ease;
        }

        .connection-status.connected {
            background: rgba(16, 185, 129, 0.1);
            border-color: rgba(16, 185, 129, 0.3);
        }

        .connection-status.disconnected {
            background: rgba(239, 68, 68, 0.1);
            border-color: rgba(239, 68, 68, 0.3);
        }

        .status-indicator {
            font-size: 1.2em;
        }

        .mongo-actions {
            display: flex;
            gap: 10px;
            margin-top: 20px;
            flex-wrap: wrap;
        }

        .mongo-actions .btn {
            flex: 1;
            min-width: 120px;
        }

        .mongo-test-result {
            margin-top: 20px;
            padding: 15px;
            border-radius: 10px;
            border-left: 4px solid;
            animation: slideIn 0.3s ease;
        }

        .mongo-test-result.success {
            background: rgba(16, 185, 129, 0.1);
            border-left-color: #10b981;
            color: #10b981;
        }

        .mongo-test-result.error {
            background: rgba(239, 68, 68, 0.1);
            border-left-color: #ef4444;
            color: #ef4444;
        }

        @keyframes slideIn {
            from {
                opacity: 0;
                transform: translateY(-10px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        /* ê°œë³„ ë¡œë´‡ ì œì–´ í…Œì´ë¸” ìŠ¤íƒ€ì¼ */
        .robot-table {
            width: 100%;
            border-collapse: collapse;
            background: rgba(59, 130, 246, 0.05);
            border-radius: 10px;
            overflow: hidden;
        }

        .robot-table th {
            background: #374151;
            color: #d1d5db;
            padding: 12px;
            text-align: left;
            font-weight: 600;
            border-bottom: 2px solid #4b5563;
        }

        .robot-table td {
            padding: 10px 12px;
            border-bottom: 1px solid #374151;
            color: #d1d5db;
        }

        .robot-table tbody tr:hover {
            background: rgba(59, 130, 246, 0.1);
        }

        .robot-controls-cell {
            display: flex;
            gap: 5px;
        }

        .robot-btn {
            padding: 4px 8px;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            font-size: 0.8em;
            transition: all 0.2s ease;
        }

        .robot-btn.start { 
            background: #059669; 
            color: white; 
        }

        .robot-btn.stop { 
            background: #dc2626; 
            color: white; 
        }

        .robot-btn.reset { 
            background: #6b7280; 
            color: white; 
        }

        .robot-btn:hover {
            transform: translateY(-1px);
            box-shadow: 0 2px 4px rgba(0,0,0,0.3);
        }

        .robot-btn:disabled {
            opacity: 0.5;
            cursor: not-allowed;
            transform: none;
        }

        /* ì„¤ì • ê·¸ë¦¬ë“œ ìŠ¤íƒ€ì¼ */
        .settings-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
            margin-bottom: 20px;
        }

        .setting-item {
            display: flex;
            flex-direction: column;
            gap: 8px;
        }

        .setting-item label {
            font-weight: 600;
            color: #d1d5db;
            font-size: 0.9em;
        }

        .setting-item input,
        .setting-item select {
            padding: 10px;
            border: 2px solid #4b5563;
            border-radius: 8px;
            background: #374151;
            color: #ffffff;
            font-size: 1em;
        }

        .setting-item input:focus,
        .setting-item select:focus {
            outline: none;
            border-color: #60a5fa;
            box-shadow: 0 0 0 3px rgba(96, 165, 250, 0.1);
        }
    </style>
</head>
<body>
    <div class="dashboard-container">
        <!-- í—¤ë” -->
        <div class="header">
            <h1>ğŸ­ AGV ìš´ì˜ ì„¼í„° ëŒ€ì‹œë³´ë“œ</h1>
            <p>ì‹¤ì‹œê°„ 30ëŒ€ ë¡œë´‡ ëª¨ë‹ˆí„°ë§ ë° ì œì–´ ì‹œìŠ¤í…œ</p>
        </div>

        <!-- ì‹¤ì‹œê°„ ìš´ì˜ í˜„í™©íŒ -->
        <div class="operation-overview">
            <!-- ì‹¤ì‹œê°„ ë¡œë´‡ ìœ„ì¹˜ ë§µ -->
            <div class="real-time-map">
                <div class="map-header">
                    <h2 class="map-title">ğŸ—ºï¸ ì‹¤ì‹œê°„ ë¡œë´‡ ìœ„ì¹˜ ë§µ</h2>
                    <div class="map-status">
                        <span class="status-badge status-active" id="activeRobotsStatus">ì •ìƒ: 25ëŒ€</span>
                        <span class="status-badge status-warning" id="warningRobotsStatus">ì£¼ì˜: 3ëŒ€</span>
                        <span class="status-badge status-error" id="errorRobotsStatus">ë¬¸ì œ: 2ëŒ€</span>
                    </div>
                </div>
                
                <!-- ê³µì¥ ë ˆì´ì•„ì›ƒ -->
                <div class="factory-layout" id="factoryLayout">
                    <!-- H3 êµ¬ì—­ -->
                    <div class="zone" data-zone="H3">
                        <div class="zone-header">ğŸ­ H3 êµ¬ì—­ (17L-15L)</div>
                        <div id="zone-H3-robots">
                            <div class="zone-empty">ë¡œë´‡ ìœ„ì¹˜ ë¡œë”© ì¤‘...</div>
                        </div>
                    </div>
                    
                    <!-- K2 êµ¬ì—­ -->
                    <div class="zone" data-zone="K2">
                        <div class="zone-header">ğŸ­ K2 êµ¬ì—­ (15L-13L)</div>
                        <div id="zone-K2-robots">
                            <div class="zone-empty">ë¡œë´‡ ìœ„ì¹˜ ë¡œë”© ì¤‘...</div>
                        </div>
                    </div>
                    
                    <!-- P1 êµ¬ì—­ -->
                    <div class="zone" data-zone="P1">
                        <div class="zone-header">ğŸ­ P1 êµ¬ì—­ (12L-10L)</div>
                        <div id="zone-P1-robots">
                            <div class="zone-empty">ë¡œë´‡ ìœ„ì¹˜ ë¡œë”© ì¤‘...</div>
                        </div>
                    </div>
                    
                    <!-- ì¶©ì „ì†Œ -->
                    <div class="zone" data-zone="CHARGE">
                        <div class="zone-header">ğŸ”‹ ì¶©ì „ì†Œ</div>
                        <div id="zone-CHARGE-robots">
                            <div class="zone-empty">ì¶©ì „ ì¤‘ì¸ ë¡œë´‡ ì—†ìŒ</div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- ìš´ì˜ í†µê³„ ì‚¬ì´ë“œë°” -->
            <div class="operation-stats">
                <h3 class="stats-title">ğŸ“Š ì‹¤ì‹œê°„ ìš´ì˜ í†µê³„</h3>
                
                <div class="stat-group">
                    <h4>ğŸ¯ ê¸ˆì¼ ì„±ê³¼</h4>
                    <div class="stat-item">
                        <span class="stat-label">ì™„ë£Œ ë¯¸ì…˜</span>
                        <span class="stat-value good" id="todayMissions">847</span>
                    </div>
                    <div class="stat-item">
                        <span class="stat-label">ëª©í‘œ ë‹¬ì„±ë¥ </span>
                        <span class="stat-value good" id="achievementRate">94%</span>
                    </div>
                    <div class="stat-item">
                        <span class="stat-label">í‰ê·  ì²˜ë¦¬ ì‹œê°„</span>
                        <span class="stat-value" id="avgProcessTime">4.2ë¶„</span>
                    </div>
                </div>

                <div class="stat-group">
                    <h4>âš¡ ì‹¤ì‹œê°„ ìƒíƒœ</h4>
                    <div class="stat-item">
                        <span class="stat-label">ì‘ì—… ì¤‘</span>
                        <span class="stat-value good" id="workingRobots">18ëŒ€</span>
                    </div>
                    <div class="stat-item">
                        <span class="stat-label">ì´ë™ ì¤‘</span>
                        <span class="stat-value" id="movingRobots">7ëŒ€</span>
                    </div>
                    <div class="stat-item">
                        <span class="stat-label">ëŒ€ê¸°/ì¶©ì „</span>
                        <span class="stat-value warning" id="idleRobots">3ëŒ€</span>
                    </div>
                    <div class="stat-item">
                        <span class="stat-label">ë¬¸ì œ ìƒí™©</span>
                        <span class="stat-value danger" id="problemRobots">2ëŒ€</span>
                    </div>
                </div>

                <div class="stat-group">
                    <h4>ğŸ”‹ ë°°í„°ë¦¬ í˜„í™©</h4>
                    <div class="stat-item">
                        <span class="stat-label">í‰ê·  ë°°í„°ë¦¬</span>
                        <span class="stat-value good" id="avgBattery">78%</span>
                    </div>
                    <div class="stat-item">
                        <span class="stat-label">ë¶€ì¡± ê²½ê³ </span>
                        <span class="stat-value warning" id="lowBatteryRobots">3ëŒ€</span>
                    </div>
                    <div class="stat-item">
                        <span class="stat-label">ì¶©ì „ í•„ìš”</span>
                        <span class="stat-value danger" id="chargingNeeded">1ëŒ€</span>
                    </div>
                </div>
            </div>
        </div>

        <!-- ì‹¤ì‹œê°„ ì‘ì—… í˜„í™© -->
        <div class="work-status-section">
            <div class="work-status-header">
                <h3 class="work-status-title">ğŸš€ ì‹¤ì‹œê°„ ì‘ì—… í˜„í™©</h3>
                <div class="work-controls">
                    <button class="btn btn-start" id="startAllBtn">â–¶ï¸ ì „ì²´ ì‹œì‘</button>
                    <button class="btn btn-stop" id="stopAllBtn">â¹ï¸ ì „ì²´ ì •ì§€</button>
                    <button class="btn btn-emergency" id="emergencyBtn">ğŸš¨ ë¹„ìƒ ì •ì§€</button>
                </div>
            </div>
            
            <div class="work-progress-list" id="workProgressList">
                <!-- ì‹¤ì‹œê°„ ì‘ì—… ì§„í–‰ ìƒí™©ì´ ì—¬ê¸°ì— í‘œì‹œë©ë‹ˆë‹¤ -->
            </div>
        </div>

        <!-- ì œì–´ íŒ¨ë„ -->
        <div class="control-panel">
            <!-- ì‹œë®¬ë ˆì´í„° ì œì–´ -->
            <div class="control-card">
                <h3 class="control-title">ğŸ® ì‹œë®¬ë ˆì´í„° ì œì–´</h3>
                <div class="control-buttons">
                    <button class="btn btn-start" id="startSimBtn">â–¶ï¸ ì‹œë®¬ë ˆì´ì…˜ ì‹œì‘</button>
                    <button class="btn btn-stop" id="stopSimBtn">â¹ï¸ ì‹œë®¬ë ˆì´ì…˜ ì •ì§€</button>
                </div>
                <div class="stat-item">
                    <span class="stat-label">ì‹œë®¬ë ˆì´í„° ìƒíƒœ</span>
                    <span class="stat-value" id="simulatorStatus">ì •ì§€ë¨</span>
                </div>
                <div class="stat-item">
                    <span class="stat-label">ì‹¤í–‰ ì‹œê°„</span>
                    <span class="stat-value" id="simulatorUptime">0ì´ˆ</span>
                </div>
            </div>

            <!-- êµ¬ì—­ë³„ íš¨ìœ¨ì„± -->
            <div class="control-card">
                <h3 class="control-title">ğŸ“ˆ êµ¬ì—­ë³„ íš¨ìœ¨ì„±</h3>
                <div class="zone-efficiency" id="zoneEfficiency">
                    <div class="efficiency-item">
                        <div class="efficiency-zone">H3 êµ¬ì—­</div>
                        <div class="efficiency-value good">102%</div>
                        <div class="efficiency-status efficiency-good">ì •ìƒ</div>
                    </div>
                    <div class="efficiency-item">
                        <div class="efficiency-zone">K2 êµ¬ì—­</div>
                        <div class="efficiency-value warning">87%</div>
                        <div class="efficiency-status efficiency-warning">ì§€ì—°</div>
                    </div>
                    <div class="efficiency-item">
                        <div class="efficiency-zone">P1 êµ¬ì—­</div>
                        <div class="efficiency-value danger">45%</div>
                        <div class="efficiency-status efficiency-poor">ë¬¸ì œ</div>
                    </div>
                </div>
            </div>
        </div>

        <!-- ì•Œë¦¼ ì„¼í„° -->
        <div class="alerts-section">
            <div class="alerts-header">
                <h3 class="alerts-title">ğŸš¨ ì‹¤ì‹œê°„ ì•Œë¦¼</h3>
                <span class="alert-count" id="totalAlerts">5</span>
            </div>
            
            <div class="alerts-list" id="alertsList">
                <div class="alert-item">
                    <span class="alert-icon">ğŸ”‹</span>
                    <div class="alert-content">
                        <div class="alert-message">AGV-003 ë°°í„°ë¦¬ ë¶€ì¡± (25%)</div>
                        <div class="alert-time">2ë¶„ ì „</div>
                    </div>
                    <span class="alert-priority priority-high">ê¸´ê¸‰</span>
                </div>
                
                <div class="alert-item">
                    <span class="alert-icon">ğŸ“¡</span>
                    <div class="alert-content">
                        <div class="alert-message">AGV-015 í†µì‹  ëŠê¹€ (ìœ„ì¹˜: H2-08L)</div>
                        <div class="alert-time">5ë¶„ ì „</div>
                    </div>
                    <span class="alert-priority priority-high">ê¸´ê¸‰</span>
                </div>
                
                <div class="alert-item">
                    <span class="alert-icon">âš ï¸</span>
                    <div class="alert-content">
                        <div class="alert-message">AGV-029 ì¥ì• ë¬¼ ê°ì§€ ì •ì§€ (K1-14L)</div>
                        <div class="alert-time">8ë¶„ ì „</div>
                    </div>
                    <span class="alert-priority priority-medium">ì£¼ì˜</span>
                </div>
            </div>
        </div>

        <!-- ê°œë³„ ë¡œë´‡ ì œì–´ ë° ë°ì´í„° ì…ë ¥ -->
        <div class="control-panel">
            <div class="control-card">
                <h3 class="control-title">ğŸ¤– ê°œë³„ ë¡œë´‡ ì œì–´</h3>
                <div class="robot-table-container" style="max-height: 400px; overflow-y: auto;">
                    <table class="robot-table" id="individualRobotTable">
                        <thead>
                            <tr>
                                <th>ë¡œë´‡ ID</th>
                                <th>ìƒíƒœ</th>
                                <th>ë°°í„°ë¦¬</th>
                                <th>ìœ„ì¹˜</th>
                                <th>ì œì–´</th>
                            </tr>
                        </thead>
                        <tbody id="individualRobotTableBody">
                            <!-- ê°œë³„ ë¡œë´‡ ëª©ë¡ì´ ì—¬ê¸°ì— ë™ì ìœ¼ë¡œ ì¶”ê°€ë©ë‹ˆë‹¤ -->
                        </tbody>
                    </table>
                </div>
            </div>

            <div class="control-card">
                <h3 class="control-title">âš™ï¸ ì‹œë®¬ë ˆì´í„° ì„¤ì •</h3>
                <div class="settings-grid">
                    <div class="setting-item">
                        <label for="seedInput">ëœë¤ ì‹œë“œ</label>
                        <input type="number" id="seedInput" placeholder="12345" value="12345">
                    </div>
                    <div class="setting-item">
                        <label for="intervalInput">ë¯¸ì…˜ ê°„ê²© (ë¶„)</label>
                        <input type="number" id="intervalInput" placeholder="10" value="10" min="1" max="60">
                    </div>
                    <div class="setting-item">
                        <label for="strictMode">ì—„ê²© ëª¨ë“œ</label>
                        <select id="strictMode">
                            <option value="false">ë¹„í™œì„±í™”</option>
                            <option value="true">í™œì„±í™”</option>
                        </select>
                    </div>
                    <div class="setting-item">
                        <label for="normalizedMode">ì •ê·œí™” ëª¨ë“œ</label>
                        <select id="normalizedMode">
                            <option value="false">ë‹¨ì¼ ì»¬ë ‰ì…˜</option>
                            <option value="true">ì •ê·œí™” ì €ì¥</option>
                        </select>
                    </div>
                </div>
                <div class="control-buttons">
                    <button class="btn btn-start" id="applySettingsBtn">âš™ï¸ ì„¤ì • ì ìš©</button>
                    <button class="btn btn-stop" id="resetSettingsBtn">ğŸ”„ ì„¤ì • ì´ˆê¸°í™”</button>
                </div>
            </div>

            <div class="control-card">
                <h3 class="control-title">ğŸ—„ï¸ MongoDB ì„¤ì •</h3>
                <div class="mongodb-config-section">
                    <div class="connection-status" id="mongoConnectionStatus">
                        <span class="status-indicator" id="mongoStatusIndicator">ğŸ”´</span>
                        <span id="mongoStatusText">ì—°ê²° ìƒíƒœ í™•ì¸ ì¤‘...</span>
                    </div>
                    
                    <div class="settings-grid">
                        <div class="setting-item">
                            <label for="mongoConnectionString">ì—°ê²° ë¬¸ìì—´</label>
                            <input type="text" id="mongoConnectionString" 
                                   placeholder="mongodb://localhost:27017/" 
                                   value="mongodb://localhost:27017/">
                        </div>
                        <div class="setting-item">
                            <label for="mongoDatabaseName">ë°ì´í„°ë² ì´ìŠ¤ëª…</label>
                            <input type="text" id="mongoDatabaseName" 
                                   placeholder="robot_data" 
                                   value="robot_data">
                        </div>
                        <div class="setting-item">
                            <label for="mongoCollectionName">ì»¬ë ‰ì…˜ëª…</label>
                            <input type="text" id="mongoCollectionName" 
                                   placeholder="robot_missions" 
                                   value="robot_missions">
                        </div>
                    </div>
                    
                    <div class="mongo-actions">
                        <button type="button" class="btn btn-primary" onclick="dashboard.testMongoConnection()">
                            ğŸ” ì—°ê²° í…ŒìŠ¤íŠ¸
                        </button>
                        <button type="button" class="btn btn-success" onclick="dashboard.saveMongoConfig()">
                            ğŸ’¾ ì„¤ì • ì €ì¥
                        </button>
                        <button type="button" class="btn btn-warning" onclick="dashboard.loadMongoConfig()">
                            ğŸ“‹ ì„¤ì • ë¶ˆëŸ¬ì˜¤ê¸°
                        </button>
                    </div>
                    
                    <div class="mongo-test-result" id="mongoTestResult" style="display: none;">
                        <div class="test-result-content" id="mongoTestContent"></div>
                    </div>
                </div>
            </div>
        </div>

        <!-- ì‹¤ì‹œê°„ ë¡œê·¸ -->
        <div class="logs-section">
            <div class="logs-header">
                <h3 class="logs-title">ğŸ“ ì‹¤ì‹œê°„ ìš´ì˜ ë¡œê·¸</h3>
            </div>
            <div class="log-container" id="logContainer">
                <div class="log-entry log-info">[16:55:52] ì‹œìŠ¤í…œ ì´ˆê¸°í™” ì™„ë£Œ - 30ëŒ€ ë¡œë´‡ ì—°ê²°ë¨</div>
                <div class="log-entry log-success">[16:55:53] AGV-001: H3-17L â†’ K2-15L ì´ë™ ì‹œì‘</div>
                <div class="log-entry log-success">[16:55:54] AGV-002: P1-12L ì‘ì—… ì™„ë£Œ (ì²˜ë¦¬ì‹œê°„: 4.2ë¶„)</div>
                <div class="log-entry log-warning">[16:55:55] AGV-003: ë°°í„°ë¦¬ ë¶€ì¡± ê²½ê³  (25%)</div>
                <div class="log-entry log-error">[16:55:56] AGV-015: í†µì‹  ëŠê¹€ ê°ì§€</div>
            </div>
        </div>
    </div>

    <!-- ë¡œë”© í‘œì‹œ -->
    <div class="loading" id="loading">
        <div class="spinner"></div>
        <div>ì²˜ë¦¬ ì¤‘...</div>
    </div>

    <script>
        class OperationalDashboard {
            constructor() {
                this.apiUrl = 'http://localhost:8080';
                this.updateIntervals = {};
                this.robotLocations = new Map();
                
                this.initializeElements();
                this.bindEvents();
                this.startRealTimeUpdates();
                
                // ì´ˆê¸° ë°ì´í„° ë¡œë“œ
                this.updateOperationalData();
                this.updateRobotMap();
                this.updateWorkProgress();
                this.updateRealTimeAlerts();
                this.updateIndividualRobotTable();
            }

            initializeElements() {
                // í†µê³„ ìš”ì†Œë“¤
                this.todayMissions = document.getElementById('todayMissions');
                this.achievementRate = document.getElementById('achievementRate');
                this.avgProcessTime = document.getElementById('avgProcessTime');
                this.workingRobots = document.getElementById('workingRobots');
                this.movingRobots = document.getElementById('movingRobots');
                this.idleRobots = document.getElementById('idleRobots');
                this.problemRobots = document.getElementById('problemRobots');
                this.avgBattery = document.getElementById('avgBattery');
                this.lowBatteryRobots = document.getElementById('lowBatteryRobots');
                this.chargingNeeded = document.getElementById('chargingNeeded');
                
                // ë§µ ìš”ì†Œë“¤
                this.factoryLayout = document.getElementById('factoryLayout');
                this.workProgressList = document.getElementById('workProgressList');
                this.alertsList = document.getElementById('alertsList');
                this.logContainer = document.getElementById('logContainer');
                
                // ì œì–´ ìš”ì†Œë“¤
                this.startSimBtn = document.getElementById('startSimBtn');
                this.stopSimBtn = document.getElementById('stopSimBtn');
                this.startAllBtn = document.getElementById('startAllBtn');
                this.stopAllBtn = document.getElementById('stopAllBtn');
                this.emergencyBtn = document.getElementById('emergencyBtn');
                
                // ê°œë³„ ë¡œë´‡ ì œì–´ ìš”ì†Œë“¤
                this.individualRobotTableBody = document.getElementById('individualRobotTableBody');
                this.seedInput = document.getElementById('seedInput');
                this.intervalInput = document.getElementById('intervalInput');
                this.strictMode = document.getElementById('strictMode');
                this.normalizedMode = document.getElementById('normalizedMode');
                this.applySettingsBtn = document.getElementById('applySettingsBtn');
                this.resetSettingsBtn = document.getElementById('resetSettingsBtn');
                
                // ìƒíƒœ ìš”ì†Œë“¤
                this.simulatorStatus = document.getElementById('simulatorStatus');
                this.simulatorUptime = document.getElementById('simulatorUptime');
                this.loading = document.getElementById('loading');
            }

            bindEvents() {
                this.startSimBtn?.addEventListener('click', () => this.startSimulator());
                this.stopSimBtn?.addEventListener('click', () => this.stopSimulator());
                this.startAllBtn?.addEventListener('click', () => this.startAllRobots());
                this.stopAllBtn?.addEventListener('click', () => this.stopAllRobots());
                this.emergencyBtn?.addEventListener('click', () => this.emergencyStop());
                
                // ì„¤ì • ë²„íŠ¼ ì´ë²¤íŠ¸
                this.applySettingsBtn?.addEventListener('click', () => this.applySettings());
                this.resetSettingsBtn?.addEventListener('click', () => this.resetSettings());
            }

            startRealTimeUpdates() {
                // ìš´ì˜ ë°ì´í„° ì—…ë°ì´íŠ¸ (5ì´ˆë§ˆë‹¤)
                this.updateIntervals.operational = setInterval(() => {
                    this.updateOperationalData();
                }, 5000);
                
                // ë¡œë´‡ ë§µ ì—…ë°ì´íŠ¸ (3ì´ˆë§ˆë‹¤)
                this.updateIntervals.robotMap = setInterval(() => {
                    this.updateRobotMap();
                }, 3000);
                
                // ì‘ì—… ì§„í–‰ ìƒí™© ì—…ë°ì´íŠ¸ (2ì´ˆë§ˆë‹¤)
                this.updateIntervals.workProgress = setInterval(() => {
                    this.updateWorkProgress();
                }, 2000);
                
                // ì‹¤ì‹œê°„ ì•Œë¦¼ ì—…ë°ì´íŠ¸ (10ì´ˆë§ˆë‹¤)
                this.updateIntervals.alerts = setInterval(() => {
                    this.updateRealTimeAlerts();
                }, 10000);
                
                // ê°œë³„ ë¡œë´‡ í…Œì´ë¸” ì—…ë°ì´íŠ¸ (5ì´ˆë§ˆë‹¤)
                this.updateIntervals.individualRobots = setInterval(() => {
                    this.updateIndividualRobotTable();
                }, 5000);
                
                // ì‹œë®¬ë ˆì´í„° ìƒíƒœ ì—…ë°ì´íŠ¸ (1ì´ˆë§ˆë‹¤)
                this.updateIntervals.simulator = setInterval(() => {
                    this.updateSimulatorStatus();
                }, 1000);
            }

            async updateOperationalData() {
                try {
                    // ğŸ”¥ ì‹¤ì œ MongoDB API í˜¸ì¶œ
                    const response = await fetch(`${this.apiUrl}/api/stats/operational`);
                    const data = await response.json();
                    
                    if (response.ok && data.success) {
                        // ì‹¤ì œ MongoDB ë°ì´í„°ë¡œ ì—…ë°ì´íŠ¸
                        this.updateElement(this.todayMissions, data.daily_stats?.completed_missions || 0);
                        this.updateElement(this.achievementRate, `${data.daily_stats?.success_rate || 0}%`);
                        this.updateElement(this.avgProcessTime, `${data.daily_stats?.avg_process_time || 0}ë¶„`);
                        
                        // ì‹¤ì‹œê°„ ìƒíƒœ ì—…ë°ì´íŠ¸
                        this.updateElement(this.workingRobots, `${data.robot_status?.working || 0}ëŒ€`);
                        this.updateElement(this.movingRobots, `${data.robot_status?.moving || 0}ëŒ€`);
                        this.updateElement(this.idleRobots, `${data.robot_status?.idle || 0}ëŒ€`);
                        this.updateElement(this.problemRobots, `${data.robot_status?.error || 0}ëŒ€`);
                        
                        // ë°°í„°ë¦¬ í˜„í™© ì—…ë°ì´íŠ¸
                        this.updateElement(this.avgBattery, `${data.battery_stats?.average || 0}%`);
                        this.updateElement(this.lowBatteryRobots, `${data.battery_stats?.low_count || 0}ëŒ€`);
                        this.updateElement(this.chargingNeeded, `${data.battery_stats?.critical_count || 0}ëŒ€`);
                        
                        this.addLog(`ğŸ“Š ì‹¤ì œ MongoDB ë°ì´í„° ì—…ë°ì´íŠ¸ ì™„ë£Œ`, 'success');
                    } else {
                        // API ì‹¤íŒ¨ ì‹œ í´ë°±: ê¸°ë³¸ê°’ í‘œì‹œ
                        throw new Error(data.error || 'API í˜¸ì¶œ ì‹¤íŒ¨');
                    }
                    
                } catch (error) {
                    this.addLog(`âš ï¸ MongoDB ì—°ê²° ì‹¤íŒ¨, ê¸°ë³¸ê°’ í‘œì‹œ: ${error.message}`, 'warning');
                    // í´ë°±: MongoDB ì—°ê²° ì‹¤íŒ¨ ì‹œ ê¸°ë³¸ê°’
                    this.updateElement(this.todayMissions, '-');
                    this.updateElement(this.achievementRate, '-');
                    this.updateElement(this.avgProcessTime, '-');
                    this.updateElement(this.workingRobots, '-');
                    this.updateElement(this.movingRobots, '-');
                    this.updateElement(this.idleRobots, '-');
                    this.updateElement(this.problemRobots, '-');
                    this.updateElement(this.avgBattery, '-');
                    this.updateElement(this.lowBatteryRobots, '-');
                    this.updateElement(this.chargingNeeded, '-');
                }
            }

            generateMockOperationalData() {
                const now = new Date();
                const variance = Math.sin(now.getTime() / 10000) * 10;
                
                return {
                    daily_stats: {
                        completed_missions: Math.floor(847 + variance),
                        success_rate: Math.floor(94 + variance / 2),
                        avg_process_time: (4.2 + variance / 10).toFixed(1)
                    },
                    robot_status: {
                        working: Math.floor(18 + variance / 2),
                        moving: Math.floor(7 + variance / 3),
                        idle: Math.floor(3 + Math.abs(variance) / 5),
                        error: Math.floor(2 + Math.abs(variance) / 8)
                    },
                    battery_stats: {
                        average: Math.floor(78 + variance),
                        low_count: Math.floor(3 + Math.abs(variance) / 5),
                        critical_count: Math.floor(1 + Math.abs(variance) / 10)
                    }
                };
            }

            async updateRobotMap() {
                try {
                    // ğŸ”¥ ì‹¤ì œ MongoDB API í˜¸ì¶œ
                    const response = await fetch(`${this.apiUrl}/api/robots`);
                    const data = await response.json();
                    
                    if (response.ok && data.success) {
                        // ì‹¤ì œ MongoDB ë¡œë´‡ ë°ì´í„° ì‚¬ìš©
                        this.renderRobotMap(data.robots);
                        this.updateMapStatus(data.summary);
                        this.addLog(`ğŸ—ºï¸ ì‹¤ì œ ë¡œë´‡ ìœ„ì¹˜ ë°ì´í„° ì—…ë°ì´íŠ¸ ì™„ë£Œ`, 'success');
                    } else {
                        throw new Error(data.error || 'ë¡œë´‡ ë°ì´í„° API í˜¸ì¶œ ì‹¤íŒ¨');
                    }
                } catch (error) {
                    this.addLog(`âš ï¸ ë¡œë´‡ ë§µ MongoDB ì—°ê²° ì‹¤íŒ¨: ${error.message}`, 'warning');
                    // í´ë°±: ê°€ì§œ ë°ì´í„°ë¡œ ëŒ€ì²´
                    const mockRobots = this.generateMockRobotData();
                    this.renderRobotMap(mockRobots);
                    this.updateMapStatus(this.calculateRobotSummary(mockRobots));
                }
            }

            generateMockRobotData() {
                const robots = [];
                const statuses = ['running', 'moving', 'idle', 'error', 'charging'];
                const now = Date.now();
                
                for (let i = 1; i <= 30; i++) {
                    const robotId = `AGV-${i.toString().padStart(3, '0')}`;
                    const statusIndex = Math.floor((i * 7 + now / 5000) % statuses.length);
                    
                    robots.push({
                        robot_id: robotId,
                        status: statuses[statusIndex],
                        battery_level: Math.floor(30 + (i * 13 + now / 1000) % 70),
                        last_seen: new Date(now - (i * 1000)).toISOString(),
                        uptime: i * 100 + Math.floor(now / 1000) % 1000
                    });
                }
                
                return robots;
            }

            calculateRobotSummary(robots) {
                return {
                    running: robots.filter(r => r.status === 'running').length,
                    idle: robots.filter(r => r.status === 'idle' || r.status === 'charging').length,
                    error: robots.filter(r => r.status === 'error').length
                };
            }

            renderRobotMap(robots) {
                // êµ¬ì—­ë³„ë¡œ ë¡œë´‡ ë¶„ë¥˜
                const zones = {
                    'H3': { robots: [], element: document.getElementById('zone-H3-robots') },
                    'K2': { robots: [], element: document.getElementById('zone-K2-robots') },
                    'P1': { robots: [], element: document.getElementById('zone-P1-robots') },
                    'CHARGE': { robots: [], element: document.getElementById('zone-CHARGE-robots') }
                };

                // ë¡œë´‡ì„ êµ¬ì—­ë³„ë¡œ ë¶„ë¥˜
                robots.forEach(robot => {
                    const location = this.getRobotZone(robot);
                    if (zones[location]) {
                        zones[location].robots.push(robot);
                    }
                });

                // ê° êµ¬ì—­ì— ë¡œë´‡ í‘œì‹œ
                Object.keys(zones).forEach(zoneKey => {
                    const zone = zones[zoneKey];
                    if (!zone.element) return;

                    if (zone.robots.length === 0) {
                        zone.element.innerHTML = '<div class="zone-empty">ë¹„ì–´ìˆìŒ</div>';
                    } else {
                        zone.element.innerHTML = zone.robots.map(robot => `
                            <div class="robot-in-zone">
                                <div class="robot-status-icon status-${this.getRobotStatusClass(robot.status)}"></div>
                                <span>${robot.robot_id}</span>
                                <span>${this.getRobotStatusText(robot.status)}</span>
                                <span>${robot.battery_level}%</span>
                            </div>
                        `).join('');
                    }
                });
            }

            getRobotZone(robot) {
                const robotNumber = parseInt(robot.robot_id.split('-')[1]);
                
                if (robot.status === 'charging' || robot.battery_level < 30) {
                    return 'CHARGE';
                }
                
                const zones = ['H3', 'K2', 'P1'];
                return zones[robotNumber % 3];
            }

            getRobotStatusClass(status) {
                const statusMap = {
                    'running': 'working',
                    'moving': 'moving',
                    'idle': 'idle',
                    'error': 'error',
                    'charging': 'charging'
                };
                return statusMap[status] || 'idle';
            }

            getRobotStatusText(status) {
                const statusMap = {
                    'running': 'ì‘ì—…ì¤‘',
                    'moving': 'ì´ë™ì¤‘',
                    'idle': 'ëŒ€ê¸°ì¤‘',
                    'error': 'ì˜¤ë¥˜',
                    'charging': 'ì¶©ì „ì¤‘'
                };
                return statusMap[status] || status;
            }

            updateMapStatus(summary) {
                const activeElement = document.getElementById('activeRobotsStatus');
                const warningElement = document.getElementById('warningRobotsStatus');
                const errorElement = document.getElementById('errorRobotsStatus');
                
                if (activeElement) activeElement.textContent = `ì •ìƒ: ${summary.running || 0}ëŒ€`;
                if (warningElement) warningElement.textContent = `ì£¼ì˜: ${summary.idle || 0}ëŒ€`;
                if (errorElement) errorElement.textContent = `ë¬¸ì œ: ${summary.error || 0}ëŒ€`;
            }

            async updateWorkProgress() {
                try {
                    // ğŸ”¥ ì‹¤ì œ MongoDB API í˜¸ì¶œ
                    const response = await fetch(`${this.apiUrl}/api/robots`);
                    const data = await response.json();
                    
                    if (response.ok && data.success) {
                        // ì‹¤ì œ MongoDB ë¡œë´‡ ë°ì´í„°ë¡œ ì‘ì—… ì§„í–‰ ìƒí™© í‘œì‹œ
                        this.renderWorkProgress(data.robots);
                        this.addLog(`ğŸš€ ì‹¤ì œ ì‘ì—… ì§„í–‰ ìƒí™© ì—…ë°ì´íŠ¸ ì™„ë£Œ`, 'success');
                    } else {
                        throw new Error(data.error || 'ì‘ì—… ì§„í–‰ API í˜¸ì¶œ ì‹¤íŒ¨');
                    }
                } catch (error) {
                    this.addLog(`âš ï¸ ì‘ì—… ì§„í–‰ MongoDB ì—°ê²° ì‹¤íŒ¨: ${error.message}`, 'warning');
                    // í´ë°±: ê°€ì§œ ë°ì´í„°ë¡œ ëŒ€ì²´
                    const mockRobots = this.generateMockRobotData();
                    this.renderWorkProgress(mockRobots);
                }
            }

            renderWorkProgress(robots) {
                // ì‘ì—… ì¤‘ì¸ ë¡œë´‡ë§Œ í‘œì‹œ
                const workingRobots = robots.filter(robot => 
                    robot.status === 'running' || robot.status === 'moving'
                ).slice(0, 6); // ìµœëŒ€ 6ê°œë§Œ í‘œì‹œ

                if (!this.workProgressList) return;

                if (workingRobots.length === 0) {
                    this.workProgressList.innerHTML = '<div class="zone-empty">í˜„ì¬ ì‘ì—… ì¤‘ì¸ ë¡œë´‡ì´ ì—†ìŠµë‹ˆë‹¤</div>';
                    return;
                }

                this.workProgressList.innerHTML = workingRobots.map(robot => {
                    const progress = this.calculateRobotProgress(robot);
                    const workDetails = this.generateWorkDetails(robot);
                    
                    return `
                        <div class="work-item">
                            <div class="work-item-header">
                                <span class="robot-id">${robot.robot_id}</span>
                                <span class="work-status ${robot.status}">${this.getRobotStatusText(robot.status)}</span>
                            </div>
                            <div class="work-details">${workDetails}</div>
                            <div class="progress-bar">
                                <div class="progress-fill" style="width: ${progress}%"></div>
                            </div>
                            <div class="work-meta">
                                <span>ë°°í„°ë¦¬: ${robot.battery_level}%</span>
                                <span>ì˜ˆìƒ ì™„ë£Œ: ${this.calculateETA(robot)}ë¶„</span>
                                <span>ì§„í–‰ë¥ : ${progress}%</span>
                            </div>
                        </div>
                    `;
                }).join('');
            }

            calculateRobotProgress(robot) {
                const robotNumber = parseInt(robot.robot_id.split('-')[1]);
                const baseProgress = (robotNumber * 7 + Date.now() / 10000) % 100;
                return Math.floor(baseProgress);
            }

            generateWorkDetails(robot) {
                const locations = ['H3-17L', 'K2-15L', 'P1-12L', 'H2-08L', 'K1-14L'];
                const robotNumber = parseInt(robot.robot_id.split('-')[1]);
                const fromLocation = locations[robotNumber % locations.length];
                const toLocation = locations[(robotNumber + 1) % locations.length];
                
                if (robot.status === 'moving') {
                    return `${fromLocation} â†’ ${toLocation} ì´ë™ ì¤‘`;
                } else {
                    return `${fromLocation}ì—ì„œ ì‘ì—… ìˆ˜í–‰ ì¤‘`;
                }
            }

            calculateETA(robot) {
                const progress = this.calculateRobotProgress(robot);
                const remaining = 100 - progress;
                return Math.ceil(remaining / 20);
            }

            async updateSimulatorStatus() {
                try {
                    const response = await fetch(`${this.apiUrl}/api/status`);
                    const status = await response.json();
                    
                    if (response.ok) {
                        this.updateElement(this.simulatorStatus, status.is_running ? 'ì‹¤í–‰ ì¤‘' : 'ì •ì§€ë¨');
                        this.updateElement(this.simulatorUptime, status.is_running ? 
                            `${Math.floor(status.uptime_seconds || 0)}ì´ˆ` : '0ì´ˆ');
                        
                        // ë²„íŠ¼ ìƒíƒœ ì—…ë°ì´íŠ¸
                        if (this.startSimBtn) this.startSimBtn.disabled = status.is_running;
                        if (this.stopSimBtn) this.stopSimBtn.disabled = !status.is_running;
                    }
                } catch (error) {
                    // ì¡°ìš©íˆ ì‹¤íŒ¨ ì²˜ë¦¬
                }
            }

            async startSimulator() {
                this.showLoading(true);
                try {
                    const response = await fetch(`${this.apiUrl}/api/start`, {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify({
                            seed: 12345,
                            strict_mode: false,
                            normalized_mode: false,
                            interval: 10
                        })
                    });

                    const result = await response.json();
                    
                    if (response.ok) {
                        this.addLog(`âœ… ì‹œë®¬ë ˆì´í„° ì‹œì‘ë¨`, 'success');
                    } else {
                        throw new Error(result.error || result.message);
                    }
                } catch (error) {
                    this.addLog(`âŒ ì‹œë®¬ë ˆì´í„° ì‹œì‘ ì‹¤íŒ¨: ${error.message}`, 'error');
                } finally {
                    this.showLoading(false);
                }
            }

            async stopSimulator() {
                this.showLoading(true);
                try {
                    const response = await fetch(`${this.apiUrl}/api/stop`, {
                        method: 'POST'
                    });

                    const result = await response.json();
                    
                    if (response.ok) {
                        this.addLog(`â¹ï¸ ì‹œë®¬ë ˆì´í„° ì •ì§€ë¨`, 'success');
                    } else {
                        throw new Error(result.error || result.message);
                    }
                } catch (error) {
                    this.addLog(`âŒ ì‹œë®¬ë ˆì´í„° ì •ì§€ ì‹¤íŒ¨: ${error.message}`, 'error');
                } finally {
                    this.showLoading(false);
                }
            }

            async startAllRobots() {
                this.showLoading(true);
                try {
                    // ğŸ”¥ ì‹¤ì œ ì „ì²´ ë¡œë´‡ ì‹œì‘ API í˜¸ì¶œ
                    const response = await fetch(`${this.apiUrl}/api/robots/start-all`, {
                        method: 'POST'
                    });
                    const result = await response.json();
                    
                    if (response.ok && result.success) {
                        this.addLog(`âœ… ì „ì²´ ë¡œë´‡ ì‹œì‘ ì™„ë£Œ: ${result.message}`, 'success');
                        // ì¦‰ì‹œ ë¡œë´‡ ìƒíƒœ ì—…ë°ì´íŠ¸
                        this.updateRobotMap();
                        this.updateWorkProgress();
                    } else {
                        throw new Error(result.error || 'ì „ì²´ ì‹œì‘ API í˜¸ì¶œ ì‹¤íŒ¨');
                    }
                } catch (error) {
                    this.addLog(`âŒ ì „ì²´ ë¡œë´‡ ì‹œì‘ ì‹¤íŒ¨: ${error.message}`, 'error');
                } finally {
                    this.showLoading(false);
                }
            }

            async stopAllRobots() {
                if (confirm('ëª¨ë“  ë¡œë´‡ì„ ì •ì§€í•˜ì‹œê² ìŠµë‹ˆê¹Œ?')) {
                    this.showLoading(true);
                    try {
                        // ğŸ”¥ ì‹¤ì œ ì „ì²´ ë¡œë´‡ ì •ì§€ API í˜¸ì¶œ
                        const response = await fetch(`${this.apiUrl}/api/robots/stop-all`, {
                            method: 'POST'
                        });
                        const result = await response.json();
                        
                        if (response.ok && result.success) {
                            this.addLog(`âœ… ì „ì²´ ë¡œë´‡ ì •ì§€ ì™„ë£Œ: ${result.message}`, 'success');
                            // ì¦‰ì‹œ ë¡œë´‡ ìƒíƒœ ì—…ë°ì´íŠ¸
                            this.updateRobotMap();
                            this.updateWorkProgress();
                        } else {
                            throw new Error(result.error || 'ì „ì²´ ì •ì§€ API í˜¸ì¶œ ì‹¤íŒ¨');
                        }
                    } catch (error) {
                        this.addLog(`âŒ ì „ì²´ ë¡œë´‡ ì •ì§€ ì‹¤íŒ¨: ${error.message}`, 'error');
                    } finally {
                        this.showLoading(false);
                    }
                }
            }

            async emergencyStop() {
                if (confirm('ğŸš¨ ë¹„ìƒ ì •ì§€ë¥¼ ì‹¤í–‰í•˜ì‹œê² ìŠµë‹ˆê¹Œ? ëª¨ë“  ë¡œë´‡ì´ ì¦‰ì‹œ ì •ì§€ë©ë‹ˆë‹¤.')) {
                    this.addLog(`ğŸš¨ ë¹„ìƒ ì •ì§€ ëª…ë ¹ ì‹¤í–‰!`, 'error');
                }
            }

            async updateRealTimeAlerts() {
                try {
                    // ğŸ”¥ ì‹¤ì œ MongoDB ê¸°ë°˜ ì•Œë¦¼ ìƒì„±
                    const response = await fetch(`${this.apiUrl}/api/robots`);
                    const data = await response.json();
                    
                    if (response.ok && data.success) {
                        const alerts = this.generateRealAlertsFromData(data.robots);
                        this.renderRealTimeAlerts(alerts);
                        this.addLog(`ğŸš¨ ì‹¤ì œ MongoDB ê¸°ë°˜ ì•Œë¦¼ ì—…ë°ì´íŠ¸ ì™„ë£Œ`, 'success');
                    } else {
                        throw new Error(data.error || 'ì•Œë¦¼ ë°ì´í„° API í˜¸ì¶œ ì‹¤íŒ¨');
                    }
                } catch (error) {
                    this.addLog(`âš ï¸ ì‹¤ì‹œê°„ ì•Œë¦¼ MongoDB ì—°ê²° ì‹¤íŒ¨: ${error.message}`, 'warning');
                    // í´ë°±: ê¸°ë³¸ ì•Œë¦¼ í‘œì‹œ
                    this.renderFallbackAlerts();
                }
            }

            generateRealAlertsFromData(robots) {
                const alerts = [];
                const now = new Date();
                
                robots.forEach(robot => {
                    // ë°°í„°ë¦¬ ë¶€ì¡± ì•Œë¦¼ (30% ì´í•˜)
                    if (robot.battery_level <= 30) {
                        alerts.push({
                            icon: 'ğŸ”‹',
                            message: `${robot.robot_id} ë°°í„°ë¦¬ ë¶€ì¡± (${robot.battery_level}%)`,
                            time: this.getRelativeTime(robot.last_seen),
                            priority: robot.battery_level <= 15 ? 'high' : 'medium'
                        });
                    }
                    
                    // í†µì‹  ëŠê¹€ ì•Œë¦¼ (5ë¶„ ì´ìƒ ì—…ë°ì´íŠ¸ ì—†ìŒ)
                    if (robot.last_seen) {
                        const lastSeenTime = new Date(robot.last_seen);
                        const timeDiff = (now - lastSeenTime) / 1000 / 60; // ë¶„ ë‹¨ìœ„
                        
                        if (timeDiff > 5) {
                            alerts.push({
                                icon: 'ğŸ“¡',
                                message: `${robot.robot_id} í†µì‹  ëŠê¹€ (${Math.floor(timeDiff)}ë¶„ ì „)`,
                                time: `${Math.floor(timeDiff)}ë¶„ ì „`,
                                priority: timeDiff > 10 ? 'high' : 'medium'
                            });
                        }
                    }
                    
                    // ì˜¤ë¥˜ ìƒíƒœ ì•Œë¦¼
                    if (robot.status === 'error') {
                        alerts.push({
                            icon: 'âš ï¸',
                            message: `${robot.robot_id} ì‹œìŠ¤í…œ ì˜¤ë¥˜ ë°œìƒ`,
                            time: this.getRelativeTime(robot.last_seen),
                            priority: 'high'
                        });
                    }
                    
                    // ì¥ì‹œê°„ ëŒ€ê¸° ì•Œë¦¼ (30ë¶„ ì´ìƒ idle)
                    if (robot.status === 'idle' && robot.uptime > 1800) { // 30ë¶„ = 1800ì´ˆ
                        alerts.push({
                            icon: 'â°',
                            message: `${robot.robot_id} ì¥ì‹œê°„ ëŒ€ê¸° ì¤‘ (${Math.floor(robot.uptime / 60)}ë¶„)`,
                            time: this.getRelativeTime(robot.last_seen),
                            priority: 'low'
                        });
                    }
                });
                
                // ìµœì‹  ìˆœìœ¼ë¡œ ì •ë ¬í•˜ê³  ìµœëŒ€ 10ê°œë§Œ
                return alerts.sort((a, b) => {
                    const priorityOrder = { 'high': 3, 'medium': 2, 'low': 1 };
                    return priorityOrder[b.priority] - priorityOrder[a.priority];
                }).slice(0, 10);
            }

            renderRealTimeAlerts(alerts) {
                if (!this.alertsList) return;
                
                // ì´ ì•Œë¦¼ ìˆ˜ ì—…ë°ì´íŠ¸
                const totalAlertsElement = document.getElementById('totalAlerts');
                if (totalAlertsElement) {
                    totalAlertsElement.textContent = alerts.length;
                }
                
                if (alerts.length === 0) {
                    this.alertsList.innerHTML = '<div class="zone-empty">í˜„ì¬ ì•Œë¦¼ì´ ì—†ìŠµë‹ˆë‹¤ âœ…</div>';
                    return;
                }
                
                this.alertsList.innerHTML = alerts.map(alert => `
                    <div class="alert-item">
                        <span class="alert-icon">${alert.icon}</span>
                        <div class="alert-content">
                            <div class="alert-message">${alert.message}</div>
                            <div class="alert-time">${alert.time}</div>
                        </div>
                        <span class="alert-priority priority-${alert.priority}">
                            ${alert.priority === 'high' ? 'ê¸´ê¸‰' : alert.priority === 'medium' ? 'ì£¼ì˜' : 'ì •ë³´'}
                        </span>
                    </div>
                `).join('');
            }

            renderFallbackAlerts() {
                if (!this.alertsList) return;
                
                this.alertsList.innerHTML = `
                    <div class="alert-item">
                        <span class="alert-icon">âš ï¸</span>
                        <div class="alert-content">
                            <div class="alert-message">MongoDB ì—°ê²° ëŠê¹€ - ì•Œë¦¼ ì‹œìŠ¤í…œ ëŒ€ê¸° ì¤‘</div>
                            <div class="alert-time">ë°©ê¸ˆ ì „</div>
                        </div>
                        <span class="alert-priority priority-medium">ì£¼ì˜</span>
                    </div>
                `;
            }

            getRelativeTime(timestamp) {
                if (!timestamp) return 'ì•Œ ìˆ˜ ì—†ìŒ';
                
                const now = new Date();
                const time = new Date(timestamp);
                const diff = Math.floor((now - time) / 1000);
                
                if (diff < 60) return `${diff}ì´ˆ ì „`;
                if (diff < 3600) return `${Math.floor(diff / 60)}ë¶„ ì „`;
                if (diff < 86400) return `${Math.floor(diff / 3600)}ì‹œê°„ ì „`;
                return `${Math.floor(diff / 86400)}ì¼ ì „`;
            }

            async updateIndividualRobotTable() {
                try {
                    // ğŸ”¥ ì‹¤ì œ MongoDB API í˜¸ì¶œ
                    const response = await fetch(`${this.apiUrl}/api/robots`);
                    const data = await response.json();
                    
                    if (response.ok && data.success) {
                        this.renderIndividualRobotTable(data.robots);
                        this.addLog(`ğŸ¤– ê°œë³„ ë¡œë´‡ í…Œì´ë¸” ì—…ë°ì´íŠ¸ ì™„ë£Œ`, 'success');
                    } else {
                        throw new Error(data.error || 'ê°œë³„ ë¡œë´‡ API í˜¸ì¶œ ì‹¤íŒ¨');
                    }
                } catch (error) {
                    this.addLog(`âš ï¸ ê°œë³„ ë¡œë´‡ í…Œì´ë¸” MongoDB ì—°ê²° ì‹¤íŒ¨: ${error.message}`, 'warning');
                    // í´ë°±: ê¸°ë³¸ ë©”ì‹œì§€ í‘œì‹œ
                    if (this.individualRobotTableBody) {
                        this.individualRobotTableBody.innerHTML = '<tr><td colspan="5">MongoDB ì—°ê²° ì‹¤íŒ¨ - ë¡œë´‡ ë°ì´í„°ë¥¼ ë¶ˆëŸ¬ì˜¬ ìˆ˜ ì—†ìŠµë‹ˆë‹¤</td></tr>';
                    }
                }
            }

            renderIndividualRobotTable(robots) {
                if (!this.individualRobotTableBody) return;
                
                this.individualRobotTableBody.innerHTML = robots.map(robot => {
                    const location = this.getRobotLocation(robot);
                    const statusClass = this.getRobotStatusClass(robot.status);
                    const statusText = this.getRobotStatusText(robot.status);
                    
                    return `
                        <tr>
                            <td><strong>${robot.robot_id}</strong></td>
                            <td>
                                <span class="robot-status ${statusClass}">
                                    ${this.getStatusIcon(robot.status)} ${statusText}
                                </span>
                            </td>
                            <td>
                                <span class="battery-level ${this.getBatteryClass(robot.battery_level)}">
                                    ${robot.battery_level}%
                                </span>
                            </td>
                            <td>${location}</td>
                            <td>
                                <div class="robot-controls-cell">
                                    ${robot.status === 'running' ? 
                                        `<button class="robot-btn stop" onclick="operationalDashboard.stopIndividualRobot('${robot.robot_id}')">ì •ì§€</button>` :
                                        `<button class="robot-btn start" onclick="operationalDashboard.startIndividualRobot('${robot.robot_id}')">ì‹œì‘</button>`
                                    }
                                    <button class="robot-btn reset" onclick="operationalDashboard.resetIndividualRobot('${robot.robot_id}')">ë¦¬ì…‹</button>
                                </div>
                            </td>
                        </tr>
                    `;
                }).join('');
            }

            getRobotLocation(robot) {
                // ì‹¤ì œ ë¡œë´‡ ìœ„ì¹˜ ì •ë³´ ìƒì„±
                const zones = ['H3-17L', 'K2-15L', 'P1-12L', 'H2-08L', 'K1-14L'];
                const robotNumber = parseInt(robot.robot_id.split('-')[1]);
                return zones[robotNumber % zones.length];
            }

            getStatusIcon(status) {
                const icons = {
                    'running': 'ğŸŸ¢',
                    'moving': 'ğŸ”µ',
                    'idle': 'ğŸŸ¡',
                    'error': 'ğŸ”´',
                    'charging': 'ğŸŸ£'
                };
                return icons[status] || 'â“';
            }

            getBatteryClass(level) {
                if (level >= 60) return 'good';
                if (level >= 30) return 'warning';
                return 'danger';
            }

            async startIndividualRobot(robotId) {
                this.showLoading(true);
                try {
                    const response = await fetch(`${this.apiUrl}/api/robots/${robotId}/start`, {
                        method: 'POST'
                    });
                    const result = await response.json();
                    
                    if (response.ok && result.success) {
                        this.addLog(`âœ… ë¡œë´‡ ${robotId} ì‹œì‘ ì™„ë£Œ`, 'success');
                        // ì¦‰ì‹œ í…Œì´ë¸” ì—…ë°ì´íŠ¸
                        this.updateIndividualRobotTable();
                        this.updateRobotMap();
                    } else {
                        throw new Error(result.error || `ë¡œë´‡ ${robotId} ì‹œì‘ ì‹¤íŒ¨`);
                    }
                } catch (error) {
                    this.addLog(`âŒ ë¡œë´‡ ${robotId} ì‹œì‘ ì‹¤íŒ¨: ${error.message}`, 'error');
                } finally {
                    this.showLoading(false);
                }
            }

            async stopIndividualRobot(robotId) {
                this.showLoading(true);
                try {
                    const response = await fetch(`${this.apiUrl}/api/robots/${robotId}/stop`, {
                        method: 'POST'
                    });
                    const result = await response.json();
                    
                    if (response.ok && result.success) {
                        this.addLog(`ğŸ›‘ ë¡œë´‡ ${robotId} ì •ì§€ ì™„ë£Œ`, 'success');
                        // ì¦‰ì‹œ í…Œì´ë¸” ì—…ë°ì´íŠ¸
                        this.updateIndividualRobotTable();
                        this.updateRobotMap();
                    } else {
                        throw new Error(result.error || `ë¡œë´‡ ${robotId} ì •ì§€ ì‹¤íŒ¨`);
                    }
                } catch (error) {
                    this.addLog(`âŒ ë¡œë´‡ ${robotId} ì •ì§€ ì‹¤íŒ¨: ${error.message}`, 'error');
                } finally {
                    this.showLoading(false);
                }
            }

            async resetIndividualRobot(robotId) {
                this.showLoading(true);
                try {
                    const response = await fetch(`${this.apiUrl}/api/robots/${robotId}/reset`, {
                        method: 'POST'
                    });
                    const result = await response.json();
                    
                    if (response.ok && result.success) {
                        this.addLog(`ğŸ”„ ë¡œë´‡ ${robotId} ë¦¬ì…‹ ì™„ë£Œ`, 'success');
                        // ì¦‰ì‹œ í…Œì´ë¸” ì—…ë°ì´íŠ¸
                        this.updateIndividualRobotTable();
                        this.updateRobotMap();
                    } else {
                        throw new Error(result.error || `ë¡œë´‡ ${robotId} ë¦¬ì…‹ ì‹¤íŒ¨`);
                    }
                } catch (error) {
                    this.addLog(`âŒ ë¡œë´‡ ${robotId} ë¦¬ì…‹ ì‹¤íŒ¨: ${error.message}`, 'error');
                } finally {
                    this.showLoading(false);
                }
            }

            applySettings() {
                const settings = {
                    seed: parseInt(this.seedInput?.value) || 12345,
                    interval: parseInt(this.intervalInput?.value) || 10,
                    strict_mode: this.strictMode?.value === 'true',
                    normalized_mode: this.normalizedMode?.value === 'true'
                };
                
                this.addLog(`âš™ï¸ ì„¤ì • ì ìš©: ${JSON.stringify(settings)}`, 'info');
                
                // ì‹œë®¬ë ˆì´í„° ì¬ì‹œì‘ (ì„¤ì • ì ìš©)
                if (confirm('ì„¤ì •ì„ ì ìš©í•˜ë ¤ë©´ ì‹œë®¬ë ˆì´í„°ë¥¼ ì¬ì‹œì‘í•´ì•¼ í•©ë‹ˆë‹¤. ê³„ì†í•˜ì‹œê² ìŠµë‹ˆê¹Œ?')) {
                    this.restartSimulatorWithSettings(settings);
                }
            }

            resetSettings() {
                if (this.seedInput) this.seedInput.value = '12345';
                if (this.intervalInput) this.intervalInput.value = '10';
                if (this.strictMode) this.strictMode.value = 'false';
                if (this.normalizedMode) this.normalizedMode.value = 'false';
                
                this.addLog(`ğŸ”„ ì„¤ì •ì´ ê¸°ë³¸ê°’ìœ¼ë¡œ ì´ˆê¸°í™”ë˜ì—ˆìŠµë‹ˆë‹¤`, 'info');
            }

            async restartSimulatorWithSettings(settings) {
                this.showLoading(true);
                try {
                    // ë¨¼ì € ì •ì§€
                    await fetch(`${this.apiUrl}/api/stop`, { method: 'POST' });
                    
                    // ì ì‹œ ëŒ€ê¸°
                    await new Promise(resolve => setTimeout(resolve, 1000));
                    
                    // ìƒˆ ì„¤ì •ìœ¼ë¡œ ì‹œì‘
                    const response = await fetch(`${this.apiUrl}/api/start`, {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify(settings)
                    });
                    
                    const result = await response.json();
                    
                    if (response.ok) {
                        this.addLog(`âœ… ìƒˆ ì„¤ì •ìœ¼ë¡œ ì‹œë®¬ë ˆì´í„° ì¬ì‹œì‘ ì™„ë£Œ`, 'success');
                    } else {
                        throw new Error(result.error || 'ì¬ì‹œì‘ ì‹¤íŒ¨');
                    }
                } catch (error) {
                    this.addLog(`âŒ ì„¤ì • ì ìš© ì¬ì‹œì‘ ì‹¤íŒ¨: ${error.message}`, 'error');
                } finally {
                    this.showLoading(false);
                }
            }

            updateElement(element, value) {
                if (element && element.textContent !== value) {
                    element.textContent = value;
                }
            }

            showLoading(show) {
                if (this.loading) {
                    this.loading.style.display = show ? 'block' : 'none';
                }
            }

            addLog(message, type = 'info') {
                if (!this.logContainer) return;
                
                const timestamp = new Date().toLocaleTimeString();
                const logEntry = document.createElement('div');
                logEntry.className = `log-entry log-${type}`;
                logEntry.textContent = `[${timestamp}] ${message}`;
                
                this.logContainer.appendChild(logEntry);
                this.logContainer.scrollTop = this.logContainer.scrollHeight;
                
                // ë¡œê·¸ ìˆ˜ ì œí•œ (ìµœëŒ€ 50ê°œ)
                const logs = this.logContainer.children;
                if (logs.length > 50) {
                    this.logContainer.removeChild(logs[0]);
                }
            }

            // MongoDB ê´€ë ¨ ë©”ì„œë“œë“¤
            async loadMongoConfig() {
                try {
                    const response = await fetch(`${this.apiUrl}/api/mongodb/config`);
                    const result = await response.json();
                    
                    if (result.success) {
                        const config = result.config;
                        document.getElementById('mongoConnectionString').value = config.connection_string || 'mongodb://localhost:27017/';
                        document.getElementById('mongoDatabaseName').value = config.database_name || 'robot_data';
                        document.getElementById('mongoCollectionName').value = config.collection_name || 'robot_missions';
                        
                        this.addLog('ğŸ“‹ MongoDB ì„¤ì •ì„ ë¶ˆëŸ¬ì™”ìŠµë‹ˆë‹¤', 'success');
                        this.checkMongoConnectionStatus();
                    } else {
                        throw new Error(result.error || 'ì„¤ì • ë¶ˆëŸ¬ì˜¤ê¸° ì‹¤íŒ¨');
                    }
                } catch (error) {
                    this.addLog(`âŒ MongoDB ì„¤ì • ë¶ˆëŸ¬ì˜¤ê¸° ì‹¤íŒ¨: ${error.message}`, 'error');
                }
            }

            async saveMongoConfig() {
                const connectionString = document.getElementById('mongoConnectionString').value;
                const databaseName = document.getElementById('mongoDatabaseName').value;
                const collectionName = document.getElementById('mongoCollectionName').value;
                
                if (!connectionString || !databaseName || !collectionName) {
                    alert('ëª¨ë“  í•„ë“œë¥¼ ì…ë ¥í•´ì£¼ì„¸ìš”!');
                    return;
                }
                
                try {
                    const response = await fetch(`${this.apiUrl}/api/mongodb/config`, {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify({
                            connection_string: connectionString,
                            database_name: databaseName,
                            collection_name: collectionName
                        })
                    });
                    
                    const result = await response.json();
                    
                    if (result.success) {
                        this.addLog('âœ… MongoDB ì„¤ì •ì´ ì €ì¥ë˜ì—ˆìŠµë‹ˆë‹¤', 'success');
                        this.showMongoTestResult(result.message, 'success');
                        this.checkMongoConnectionStatus();
                    } else {
                        throw new Error(result.error || 'ì„¤ì • ì €ì¥ ì‹¤íŒ¨');
                    }
                } catch (error) {
                    this.addLog(`âŒ MongoDB ì„¤ì • ì €ì¥ ì‹¤íŒ¨: ${error.message}`, 'error');
                    this.showMongoTestResult(`ì €ì¥ ì‹¤íŒ¨: ${error.message}`, 'error');
                }
            }

            async testMongoConnection() {
                const connectionString = document.getElementById('mongoConnectionString').value;
                const databaseName = document.getElementById('mongoDatabaseName').value;
                
                if (!connectionString || !databaseName) {
                    alert('ì—°ê²° ë¬¸ìì—´ê³¼ ë°ì´í„°ë² ì´ìŠ¤ëª…ì„ ì…ë ¥í•´ì£¼ì„¸ìš”!');
                    return;
                }
                
                this.updateConnectionStatus('testing', 'ğŸ”„ ì—°ê²° í…ŒìŠ¤íŠ¸ ì¤‘...');
                
                try {
                    const response = await fetch(`${this.apiUrl}/api/mongodb/test`, {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify({
                            connection_string: connectionString,
                            database_name: databaseName
                        })
                    });
                    
                    const result = await response.json();
                    
                    if (result.success) {
                        this.addLog(`âœ… MongoDB ì—°ê²° í…ŒìŠ¤íŠ¸ ì„±ê³µ`, 'success');
                        this.updateConnectionStatus('connected', `ğŸŸ¢ ${result.message}`);
                        
                        let testMessage = `${result.message}\\n`;
                        testMessage += `ë°ì´í„°ë² ì´ìŠ¤: ${result.database_name}\\n`;
                        testMessage += `ì„œë²„ ë²„ì „: ${result.server_version || 'Unknown'}\\n`;
                        testMessage += `ì»¬ë ‰ì…˜ ìˆ˜: ${result.collections ? result.collections.length : 0}`;
                        
                        this.showMongoTestResult(testMessage, 'success');
                    } else {
                        throw new Error(result.message || result.error || 'ì—°ê²° ì‹¤íŒ¨');
                    }
                } catch (error) {
                    this.addLog(`âŒ MongoDB ì—°ê²° í…ŒìŠ¤íŠ¸ ì‹¤íŒ¨: ${error.message}`, 'error');
                    this.updateConnectionStatus('disconnected', 'ğŸ”´ ì—°ê²° ì‹¤íŒ¨');
                    this.showMongoTestResult(`ì—°ê²° ì‹¤íŒ¨: ${error.message}`, 'error');
                }
            }

            updateConnectionStatus(status, text) {
                const statusElement = document.getElementById('mongoConnectionStatus');
                const textElement = document.getElementById('mongoStatusText');
                
                if (statusElement) {
                    statusElement.className = `connection-status ${status}`;
                }
                
                if (textElement) {
                    textElement.textContent = text;
                }
            }

            showMongoTestResult(message, type) {
                const resultElement = document.getElementById('mongoTestResult');
                const contentElement = document.getElementById('mongoTestContent');
                
                if (resultElement && contentElement) {
                    contentElement.innerHTML = message.replace(/\\n/g, '<br>');
                    resultElement.className = `mongo-test-result ${type}`;
                    resultElement.style.display = 'block';
                    
                    // 5ì´ˆ í›„ ìë™ìœ¼ë¡œ ìˆ¨ê¸°ê¸°
                    setTimeout(() => {
                        resultElement.style.display = 'none';
                    }, 5000);
                }
            }

            async checkMongoConnectionStatus() {
                try {
                    const response = await fetch(`${this.apiUrl}/api/mongodb/health`);
                    const result = await response.json();
                    
                    if (result.status === 'healthy') {
                        this.updateConnectionStatus('connected', 'ğŸŸ¢ ì—°ê²°ë¨');
                    } else {
                        this.updateConnectionStatus('disconnected', 'ğŸ”´ ì—°ê²° ì•ˆë¨');
                    }
                } catch (error) {
                    this.updateConnectionStatus('disconnected', 'ğŸ”´ ì—°ê²° í™•ì¸ ì‹¤íŒ¨');
                }
            }
        }

        // ëŒ€ì‹œë³´ë“œ ì´ˆê¸°í™”
        document.addEventListener('DOMContentLoaded', () => {
            window.dashboard = new OperationalDashboard();
            // MongoDB ì„¤ì • ìë™ ë¶ˆëŸ¬ì˜¤ê¸°
            setTimeout(() => {
                window.dashboard.loadMongoConfig();
            }, 1000);
        });
    </script>
</body>
</html>
